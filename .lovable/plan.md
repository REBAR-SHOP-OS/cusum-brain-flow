

## بهبود کیفیت پرامپت Generate Fix

### مشکل فعلی
پرامپت‌های تولیدی ناقص هستند چون:
1. سیستم پرامپت محدودیت ۴۰۰ کلمه‌ای دارد که باعث کوتاهی بیش از حد می‌شود
2. اطلاعات کافی به AI ارسال نمی‌شود (attachment ها، اولویت، وضعیت تسک)
3. مدل ضعیف‌تر (`gpt-4o-mini`) برای تسک‌های بدون اسکرین‌شات استفاده می‌شود
4. حداکثر توکن خروجی ۱۲۰۰ است که کم است

### تغییرات

**1. `supabase/functions/generate-fix-prompt/index.ts`**

- سیستم پرامپت بازنویسی شود:
  - محدودیت ۴۰۰ کلمه‌ای حذف شود و به ۸۰۰ کلمه افزایش یابد
  - بخش جدید `ROOT CAUSE ANALYSIS` اضافه شود
  - بخش `CONTEXT` اضافه شود برای ذکر اینکه این یک اپلیکیشن React/TypeScript/Supabase با ساختار خاص است
  - دستورالعمل برای تحلیل عمیق‌تر: بررسی اینکه آیا مشکل فرانت‌اند است یا بک‌اند، آیا مربوط به RLS/دیتابیس/UI/API است
  - بخش `TESTING` اضافه شود: چگونه صحت رفع مشکل تایید شود
- مدل برای همه درخواست‌ها (حتی بدون اسکرین‌شات) به `gpt-4o` یا `gemini-2.5-pro` ارتقا یابد
- `maxTokens` از ۱۲۰۰ به ۲۵۰۰ افزایش یابد
- ورودی `priority`، `status`، `attachment_urls` به پیام اضافه شود

**2. `src/pages/Tasks.tsx`**

- هنگام فراخوانی edge function، اطلاعات بیشتر ارسال شود:
  - `priority`: اولویت تسک
  - `status`: وضعیت فعلی تسک
  - `attachment_urls`: لینک فایل‌های ضمیمه شده
  - `source`: منبع تسک (دستی، AI، ایمیل و غیره)

### جزئیات فنی

| فایل | تغییر |
|------|-------|
| `generate-fix-prompt/index.ts` خط ۱۰-۲۷ | بازنویسی SYSTEM_PROMPT با تحلیل عمیق‌تر |
| `generate-fix-prompt/index.ts` خط ۹۳-۱۰۱ | تغییر مدل به gemini-2.5-pro و افزایش maxTokens |
| `generate-fix-prompt/index.ts` خط ۳۵-۵۸ | اضافه کردن priority/status/attachments به evidence |
| `Tasks.tsx` خط ۱۳۳۶-۱۳۴۳ | ارسال فیلدهای اضافی (priority, status, attachment_urls, source) |

### ساختار جدید پرامپت خروجی

```text
**PROBLEM:** خلاصه یک خطی
**ROOT CAUSE:** تحلیل ریشه‌ای مشکل
**FILE/COMPONENT:** مسیر دقیق فایل‌ها
**FIX:** دستورالعمل گام‌به‌گام دقیق
**TESTING:** نحوه تایید رفع مشکل
**DO NOT TOUCH:** لیست فایل‌هایی که نباید تغییر کنند
**SURGICAL LAW:** فقط بخش‌های ذکر شده تغییر کنند
```

### نتیجه
- پرامپت‌ها کامل‌تر و جامع‌تر خواهند بود
- تحلیل ریشه‌ای مشکل ارائه می‌شود
- دستورالعمل تست اضافه می‌شود
- مدل قوی‌تر خروجی بهتری تولید می‌کند

