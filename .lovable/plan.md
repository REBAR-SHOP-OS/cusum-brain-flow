

## اصلاح کامل ایجنت Pixel — افزودن قابلیت تولید تصویر و بازنویسی پرامپت

### مشکل اصلی
ایجنت Pixel ابزار تولید تصویر (`generate_image`) ندارد. پرامپت می‌گوید "تصویر بساز" اما ایجنت فقط ابزار `create_notifications` را دارد. به همین دلیل پاسخ بی‌ربط می‌دهد.

### تغییرات مورد نیاز

#### 1. افزودن ابزار `generate_image` برای ایجنت social
**فایل:** `supabase/functions/_shared/agentTools.ts`

یک ابزار جدید برای ایجنت `social` اضافه می‌شود که تصویر تولید کند:
- نام: `generate_image`
- پارامترها: `prompt` (توضیح تصویر)، `slot` (شماره اسلات)
- این ابزار توسط ایجنت فراخوانی شده و تصویر تولید می‌کند

#### 2. پیاده‌سازی اجرای ابزار `generate_image`
**فایل:** `supabase/functions/_shared/agentToolExecutor.ts`

منطق اجرای ابزار:
- از `LOVABLE_API_KEY` و `google/gemini-3-pro-image-preview` با `modalities: ["image", "text"]` استفاده می‌شود (همان الگوی موجود در `auto-generate-post`)
- تصویر base64 تولید شده در باکت `social-images` آپلود می‌شود
- URL عمومی تصویر به ایجنت برگردانده می‌شود تا در پاسخ نمایش دهد

#### 3. بازنویسی پرامپت Pixel
**فایل:** `supabase/functions/_shared/agents/marketing.ts`

پرامپت بخش `social` بازنویسی می‌شود تا دقیقاً مطابق خواسته شما عمل کند:

**رفتار جدید:**
- **مرحله ۱:** وقتی چت جدید باز می‌شود یا کاربر درخواست محتوا می‌دهد → جدول ساعت‌ها با تاریخ امروز نمایش داده شود
- **مرحله ۲:** وقتی کاربر شماره اسلات یا ساعت را می‌نویسد → فوراً ابزار `generate_image` فراخوانی شده، تصویر تولید شود و سپس کپشن + هشتگ + آدرس نوشته شود
- محصولات مجاز، اطلاعات تماس، و قوانین تصویری دقیقاً از پرامپت شما گرفته می‌شود

#### 4. مسیریابی مدل مخصوص Pixel
**فایل:** `supabase/functions/_shared/aiRouter.ts`

ایجنت `social` به `gemini-2.5-flash` مسیریابی می‌شود (سریع برای نمایش جدول و فراخوانی ابزار) — بدون تغییر، همان پیش‌فرض فعلی کافی است.

### خلاصه فایل‌های تغییریافته

| فایل | تغییر |
|------|-------|
| `agentTools.ts` | افزودن ابزار `generate_image` برای agent=social |
| `agentToolExecutor.ts` | پیاده‌سازی تولید تصویر با Gemini + آپلود به storage |
| `agents/marketing.ts` | بازنویسی پرامپت social مطابق خواسته کاربر |

### هیچ بخش دیگری تغییر نمی‌کند
UI، دیتابیس، سایر ایجنت‌ها، و منطق `AgentWorkspace.tsx` بدون تغییر می‌مانند.

